<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MoE Backend Performance: CUTLASS vs TRT-LLM Complete Analysis</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Inter', 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
            color: #ffffff;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 60px 20px;
            margin-bottom: 40px;
            position: relative;
        }
        
        header::before {
            content: "";
            position: absolute;
            top: 50%;
            left: 50%;
            width: 600px;
            height: 600px;
            background: radial-gradient(circle, rgba(94,92,230,0.1) 0%, transparent 70%);
            transform: translate(-50%, -50%);
            z-index: -1;
        }
        
        h1 {
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, #5E5CE6 0%, #60a5fa 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.02em;
        }
        
        .subtitle {
            font-size: 1.3rem;
            color: #8E8E93;
            margin-bottom: 10px;
        }
        
        .dataset-tabs {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }
        
        .tab-button {
            padding: 12px 30px;
            background: #1C1C1E;
            border: 2px solid #2C2C2E;
            color: #8E8E93;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 1rem;
        }
        
        .tab-button:hover {
            border-color: #5E5CE6;
            transform: translateY(-2px);
        }
        
        .tab-button.active {
            background: linear-gradient(135deg, #5E5CE6 0%, #60a5fa 100%);
            color: #ffffff;
            border-color: transparent;
        }
        
        .dataset-content {
            display: none;
        }
        
        .dataset-content.active {
            display: block;
        }

        /* Command Section Styles */
        .command-section {
            background: rgba(10,10,10,0.8);
            border: 1px solid #1C1C1E;
            border-radius: 16px;
            padding: 30px;
            margin: 40px 0;
            backdrop-filter: blur(10px);
        }
        
        .section-header {
            display: flex;
            align-items: center;
            cursor: pointer;
            user-select: none;
            gap: 15px;
        }
        
        .section-header:hover {
            opacity: 0.8;
        }
        
        .toggle-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            background: #5E5CE6;
            border-radius: 6px;
            transition: transform 0.3s ease;
            font-size: 0.9rem;
            flex-shrink: 0;
        }
        
        .toggle-icon.collapsed {
            transform: rotate(-90deg);
        }
        
        .command-section h2 {
            font-size: 1.5rem;
            color: #60a5fa;
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 0;
        }
        
        .section-content {
            max-height: 2000px;
            overflow: hidden;
            transition: all 0.3s ease;
            margin-top: 20px;
        }
        
        .section-content.collapsed {
            max-height: 0;
            margin-top: 0;
            opacity: 0;
            visibility: hidden;
        }
        
        .code-block {
            background: #0a0a0a;
            border: 1px solid #2C2C2E;
            border-radius: 8px;
            padding: 20px;
            overflow-x: auto;
            position: relative;
            margin: 15px 0;
        }
        
        .code-block code {
            color: #10b981;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.95rem;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .copy-button {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 8px 16px;
            background: #5E5CE6;
            color: #fff;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s ease;
            opacity: 0;
            z-index: 10;
        }
        
        .code-block:hover .copy-button {
            opacity: 1;
        }
        
        .copy-button:hover {
            background: #4F4CD5;
            transform: translateY(-2px);
        }
        
        .copy-button.copied {
            background: #10b981;
        }
        
        .hero-results {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        @media (max-width: 968px) {
            .hero-results {
                grid-template-columns: 1fr;
            }
        }
        
        .result-card {
            background: rgba(10,10,10,0.8);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 16px;
            border: 1px solid #1C1C1E;
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease;
        }
        
        .result-card:hover {
            transform: translateY(-5px);
        }
        
        .result-card.winner {
            border-color: #5E5CE6;
            background: linear-gradient(180deg, rgba(94,92,230,0.1) 0%, rgba(10,10,10,0.9) 100%);
        }
        
        .result-card h3 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #ffffff;
        }
        
        .winner-badge {
            font-size: 0.8rem;
            padding: 4px 12px;
            border-radius: 20px;
            background: linear-gradient(135deg, #5E5CE6, #60a5fa);
            color: #ffffff;
            font-weight: 600;
        }
        
        .result-metric {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(28,28,30,0.5);
        }
        
        .result-metric:last-child {
            border-bottom: none;
        }
        
        .metric-label {
            color: #8E8E93;
        }
        
        .metric-value {
            font-weight: 600;
            font-size: 1.1rem;
            color: #ffffff;
        }
        
        .metric-value.highlight {
            background: linear-gradient(135deg, #5E5CE6 0%, #60a5fa 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 1.3rem;
        }
        
        .section {
            background: rgba(10,10,10,0.8);
            backdrop-filter: blur(10px);
            padding: 40px;
            border-radius: 16px;
            margin-bottom: 30px;
            border: 1px solid #1C1C1E;
        }
        
        h2 {
            font-size: 2rem;
            margin-bottom: 25px;
            background: linear-gradient(135deg, #5E5CE6 0%, #60a5fa 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 600;
        }
        
        h3 {
            font-size: 1.3rem;
            margin: 30px 0 15px 0;
            color: #ffffff;
        }
        
        .chart-container {
            background: rgba(10,10,10,0.6);
            padding: 30px;
            border-radius: 16px;
            margin-bottom: 30px;
            border: 1px solid #1C1C1E;
        }
        
        .chart-wrapper {
            position: relative;
            height: 450px;
            margin: 20px 0;
        }
        
        .gap-analysis-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 30px;
        }
        
        @media (max-width: 768px) {
            .gap-analysis-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .gap-card {
            background: rgba(0,0,0,0.5);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #1C1C1E;
        }
        
        .gap-card h4 {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: #ffffff;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .badge-cutlass {
            width: 12px;
            height: 12px;
            background: #f59e0b;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(245,158,11,0.5);
        }
        
        .badge-trtllm {
            width: 12px;
            height: 12px;
            background: #ef4444;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(239,68,68,0.5);
        }
        
        .insights-section {
            background: linear-gradient(135deg, rgba(94,92,230,0.05) 0%, rgba(10,10,10,0.8) 100%);
            padding: 30px;
            border-radius: 16px;
            margin-top: 30px;
            border: 1px solid #1C1C1E;
        }
        
        .insights-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 20px;
        }
        
        @media (max-width: 768px) {
            .insights-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .insight-card ul {
            list-style: none;
            padding: 0;
        }
        
        .insight-card li {
            padding: 8px 0;
            color: #cbd5e1;
            font-size: 0.95rem;
            position: relative;
            padding-left: 20px;
        }
        
        .insight-card li:before {
            content: "▸";
            position: absolute;
            left: 0;
            color: #5E5CE6;
        }

        .insights-section {
                background: linear-gradient(135deg, rgba(94,92,230,0.08) 0%, rgba(10,10,10,0.95) 100%);
                padding: 40px;
                border-radius: 16px;
                margin-top: 40px;
                margin-bottom: 40px;
                border: 1px solid rgba(94,92,230,0.2);
                backdrop-filter: blur(10px);
            }
            
            .insights-section > h2 {
                font-size: 2rem;
                margin-bottom: 30px;
                background: linear-gradient(135deg, #5E5CE6 0%, #60a5fa 100%);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                font-weight: 600;
            }
            
            .insights-grid {
                display: grid;
                grid-template-columns: 1fr;
                gap: 30px;
                margin-top: 20px;
            }
            
            .insight-card {
                background: rgba(20,20,22,0.6);
                backdrop-filter: blur(10px);
                padding: 30px;
                border-radius: 12px;
                border: 1px solid rgba(94,92,230,0.15);
                transition: all 0.3s ease;
            }
            
            .insight-card:hover {
                border-color: rgba(94,92,230,0.4);
                background: rgba(20,20,22,0.8);
                box-shadow: 0 8px 32px rgba(94,92,230,0.1);
            }
            
            .insight-card > h3 {
                font-size: 1.5rem;
                color: #60a5fa;
                margin-bottom: 20px;
                font-weight: 600;
            }
            
            .conclusion-intro {
                background: rgba(94,92,230,0.05);
                padding: 16px 20px;
                border-left: 3px solid #5E5CE6;
                border-radius: 8px;
                margin-bottom: 25px;
            }
            
            .conclusion-intro p {
                color: #cbd5e1;
                font-size: 0.95rem;
                line-height: 1.6;
                margin: 0;
            }
            
            .conclusion-intro strong {
                color: #60a5fa;
                font-weight: 600;
            }
            
            .insight-section-group {
                margin-bottom: 28px;
            }
            
            .insight-section-group:last-child {
                margin-bottom: 0;
            }
            
            .insight-subsection-title {
                font-size: 1.1rem;
                color: #60a5fa;
                margin-bottom: 12px;
                font-weight: 600;
                display: flex;
                align-items: center;
                gap: 8px;
            }
            
            .insight-list {
                list-style: none;
                padding: 0;
                margin: 0;
                display: flex;
                flex-direction: column;
                gap: 10px;
            }
            
            .insight-list li {
                padding: 10px 0 10px 28px;
                color: #cbd5e1;
                font-size: 0.95rem;
                line-height: 1.6;
                position: relative;
            }
            
            .insight-list li::before {
                content: "▸";
                position: absolute;
                left: 8px;
                color: #5E5CE6;
                font-weight: bold;
                font-size: 1.1rem;
            }
            
            .insight-list strong {
                color: #ffffff;
                font-weight: 600;
            }
            
            /* Responsive Design */
            @media (max-width: 768px) {
                .insights-section {
                    padding: 25px;
                    margin-top: 30px;
                    margin-bottom: 30px;
                }
                
                .insights-section > h2 {
                    font-size: 1.5rem;
                    margin-bottom: 20px;
                }
                
                .insight-card {
                    padding: 20px;
                }
                
                .insight-card > h3 {
                    font-size: 1.3rem;
                }
                
                .insight-subsection-title {
                    font-size: 1rem;
                }
                
                .insight-list li {
                    font-size: 0.9rem;
                    padding: 8px 0 8px 24px;
                }
            }

        .gpu-comparison-section {
            background: rgba(10,10,10,0.9);
            backdrop-filter: blur(10px);
            padding: 40px;
            border-radius: 16px;
            margin-bottom: 40px;
            border: 1px solid #1C1C1E;
        }
        
        .gpu-comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: rgba(0,0,0,0.5);
            border-radius: 12px;
            overflow: hidden;
        }
        
        .gpu-comparison-table th {
            background: linear-gradient(135deg, rgba(94,92,230,0.2) 0%, rgba(96,165,250,0.2) 100%);
            color: #60a5fa;
            font-weight: 600;
            text-align: left;
            padding: 15px;
            border-bottom: 2px solid rgba(94,92,230,0.3);
            font-size: 0.9rem;
            letter-spacing: 0.5px;
        }
        
        .gpu-comparison-table td {
            padding: 12px 15px;
            border-bottom: 1px solid rgba(28,28,30,0.5);
            font-size: 0.85rem;
            vertical-align: top;
        }

        .gpu-comparison-table tr:hover {
            background: rgba(94,92,230,0.05);
        }
        
        .metric-dimension {
            color: #8E8E93;
            font-weight: 600;
            white-space: nowrap;
        }
        
        .gpu-b200 {
            color: #10b981;
            font-weight: 600;
        }
        
        .gpu-h100 {
            color: #60a5fa;
            font-weight: 600;
        }
        
        .gpu-a100 {
            color: #f59e0b;
            font-weight: 600;
        }

        .highlight-value {
            color: #5E5CE6;
            font-weight: 700;
        }

        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            overflow: hidden;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(28,28,30,0.5);
            font-size: 0.9rem;
        }
        
        th {
            background: rgba(94,92,230,0.1);
            color: #60a5fa;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 0.5px;
        }
        
        tr:hover {
            background: rgba(94,92,230,0.05);
        }
        
        .perf-good {
            color: #10b981;
            font-weight: 600;
        }
        
        .perf-bad {
            color: #ef4444;
            font-weight: 600;
        }
        
        .perf-neutral {
            color: #f59e0b;
            font-weight: 600;
        }
        
        .custom-tooltip {
            position: absolute;
            background: rgba(30,41,59,0.95);
            backdrop-filter: blur(10px);
            border: 1px solid #475569;
            border-radius: 8px;
            padding: 12px;
            pointer-events: none;
            z-index: 1000;
            display: none;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
        }
        
        .tooltip-title {
            font-weight: 600;
            color: #60a5fa;
            margin-bottom: 8px;
        }
        
        .tooltip-content {
            color: #e2e8f0;
            font-size: 0.9rem;
        }
        
        .tooltip-gap {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid #475569;
        }
        
        .gap-positive {
            color: #ef4444;
        }
        
        .gap-negative {
            color: #10b981;
        }
        
        @media (max-width: 768px) {
            h1 { font-size: 2rem; }
            .section { padding: 20px; }
            table { font-size: 0.75rem; }
            th, td { padding: 8px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>MoE Backend Performance Analysis</h1>
            <p class="subtitle">Analysis: CUTLASS vs TensorRT-LLM on GPT-OSS-120B</p>
            <p class="subtitle" style="color: #60a5fa;">Ideal vs Actual Experts Load Balance Problem</p>
        </header>

        <div class="gpu-comparison-section">
            <h2>GPU Architecture Comparison for MoE Inference</h2>
            <p style="color: #8E8E93; margin-bottom: 20px;">Hardware capabilities comparison across NVIDIA Blackwell, Hopper, and Ampere architectures</p>
            
            <table class="gpu-comparison-table">
                <thead>
                    <tr>
                        <th style="width: 20%;">Dimension (MoE-Related)</th>
                        <th style="width: 28%;">B200 (Blackwell)</th>
                        <th style="width: 26%;">H100 (Hopper)</th>
                        <th style="width: 26%;">A100 (Ampere)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="metric-dimension">Tensor Core Gen & Precision</td>
                        <td class="gpu-b200"><strong>5th Gen</strong><br>FP4/FP6/FP8<br>2nd Gen Transformer Engine</td>
                        <td class="gpu-h100"><strong>4th Gen</strong><br>FP8 + Transformer Engine</td>
                        <td class="gpu-a100"><strong>3rd Gen</strong><br>TF32/BF16/FP16/INT8</td>
                    </tr>
                    <tr>
                        <td class="metric-dimension">Low Precision Performance<br>(Per Card)</td>
                        <td class="gpu-b200"><span class="highlight-value">FP8: 4.5/9 PFLOPS</span><br>(dense/sparse)<br>FP4: ~18 PFLOPS/card</td>
                        <td class="gpu-h100">FP8: ~2/4 PFLOPS<br>(dense/sparse)</td>
                        <td class="gpu-a100">BF16/FP16: 312/624 TFLOPS<br>(dense/sparse)</td>
                    </tr>
                    <tr>
                        <td class="metric-dimension">HBM Capacity & Bandwidth</td>
                        <td class="gpu-b200"><span class="highlight-value">180 GB HBM3e</span><br>~8 TB/s bandwidth</td>
                        <td class="gpu-h100">80 GB HBM3<br>>3 TB/s bandwidth</td>
                        <td class="gpu-a100">80 GB HBM2e<br>~2.0 TB/s bandwidth</td>
                    </tr>
                    <tr class="comm-highlight">
                        <td class="metric-dimension">🔗 NVLink Bandwidth<br>(Direct GPU-GPU)</td>
                        <td class="gpu-b200"><span class="highlight-value">Gen5: 1.8 TB/s</span><br>(18×100 GB/s)</td>
                        <td class="gpu-h100">Gen4: 900 GB/s</td>
                        <td class="gpu-a100">Gen3: 600 GB/s</td>
                    </tr>
                    <!-- <tr class="comm-highlight">
                        <td class="metric-dimension">🔗 NVSwitch/Cabinet Domain</td>
                        <td class="gpu-b200"><span class="highlight-value">NVL72: 72 GPUs</span><br>130 TB/s total<br>1.8 TB/s cross-cabinet</td>
                        <td class="gpu-h100">256 H100 cross-node<br>57.6 TB/s full mesh</td>
                        <td class="gpu-a100">8-16 cards single machine<br>600 GB/s per card</td>
                    </tr>
                    <tr>
                        <td class="metric-dimension">Structured Sparsity (2:4)</td>
                        <td class="gpu-b200">✓ Supported<br>(2x effective throughput)</td>
                        <td class="gpu-h100">✓ Supported</td>
                        <td class="gpu-a100">✓ First introduced</td>
                    </tr> -->
                    <tr>
                        <td class="metric-dimension">Hardware Decompression</td>
                        <td class="gpu-b200"><span class="highlight-value">✓ DE Engine</span><br>~600 GB/s decompress<br>Snappy/LZ4/Deflate</td>
                        <td class="gpu-h100">✗ Not available</td>
                        <td class="gpu-a100">✗ Not available</td>
                    </tr>
                    <tr>
                        <td class="metric-dimension">New Instructions/Memory</td>
                        <td class="gpu-b200"><strong>tcgen05.mma</strong><br>Tensor Memory<br>Enhanced TMA broadcast</td>
                        <td class="gpu-h100">WGMMA + TMA<br>Thread block clusters</td>
                        <td class="gpu-a100">HMMA</td>
                    </tr>
                    <tr style="background: rgba(94,92,230,0.05);">
                        <td class="metric-dimension"><strong>MoE Impact Summary</strong></td>
                        <td class="significance">Lower precision + higher bandwidth enables efficient expert weight loading & GEMM fusion</td>
                        <td class="significance">Strong all-to-all performance with FP8 acceleration</td>
                        <td class="significance">Baseline MoE support, limited by bandwidth & communication</td>
                    </tr>
                </tbody>
            </table>
            
            <div style="margin-top: 20px; padding: 15px; background: rgba(94,92,230,0.1); border-radius: 8px; border-left: 4px solid #5E5CE6;">
                <p style="color: #cbd5e1; font-size: 0.9rem;">
                    <strong style="color: #60a5fa;">🔗 Communication Metrics:</strong> The highlighted rows (NVLink bandwidth and NVSwitch domain) directly impact MoE's all-to-all communication patterns. 
                    B200's 3x improvement in NVLink bandwidth (1.8 TB/s vs 600 GB/s on A100) significantly reduces expert routing overhead in multi-GPU deployments.
                </p>
            </div>
        </div>

        <!-- Command Section -->
        <div class="command-section">
            <div class="section-header" onclick="toggleSection(this)">
                    <div class="toggle-icon">▶</div>
                    <h2>⚙️ Run High Throughput Benchmark Command</h2>
                </div>
                <div class="section-content">
                    <!-- Enable Perfect Router Command -->
                    <div class="command-section" style="margin-top: 0; margin-bottom: 32px;">
                        <h2 style="color: #60a5fa;">Enable Perfect Router</h2>
                        <div class="code-block">
                            <button class="copy-button" onclick="copyToClipboard(event)">📋 Copy</button>
                            <code>export ENABLE_PERFECT_ROUTER=1</code>
                        </div>
                        <p style="color: #8E8E93; margin-top: 10px;">Set this environment variable before running your MoE backend to enable perfect routing for benchmarking.</p>
                    </div>
                    <div class="code-block">
                        <button class="copy-button" onclick="copyToClipboard(event)">📋 Copy</button>
                        <code>#!/bin/bash

num_gpus=4
max_batch_size=640

cat <<EOF > max_throughput.yaml
enable_attention_dp: true
cuda_graph_config:
    max_batch_size: ${max_batch_size}
    enable_padding: true
stream_interval: 10
moe_config:
    backend: CUTLASS
EOF

trtllm-bench \
    --model openai/gpt-oss-120b \
    throughput \
    --backend pytorch \
    --tp ${num_gpus} \
    --ep ${num_gpus} \
    --extra_llm_api_options max_throughput.yaml \
    --dataset gpt-oss-120b-1k2k.txt \
    --max_batch_size ${max_batch_size} \
    --concurrency $((max_batch_size * num_gpus)) \
    --num_requests $((max_batch_size * num_gpus * 3)) \
    --kv_cache_free_gpu_mem_fraction 0.9 \
    --streaming \
    --warmup 0 \
    --report_json max_throughput_benchmark.json</code>
                    </div>
                </div>
        </div>

        <!-- MoE Architecture Diagram Section -->
        <div class="architecture-section" style="margin: 40px auto; max-width: 1200px; padding: 30px; background: rgba(10,10,10,0.8); border: 1px solid #1C1C1E; border-radius: 16px; backdrop-filter: blur(10px);">
            <h2 style="text-align: center; color: #60a5fa; margin-bottom: 30px; font-size: 2rem;">MoE Architecture</h2>
            <div class="architecture-diagram" style="display: flex; flex-direction: column; align-items: center;">
                <img src="./images/moe_communication.png" alt="Transformer block vs Transformer block with MoE" style="max-width: 1000px; width: 100%; height: auto; border-radius: 12px; box-shadow: 0 6px 30px rgba(0,0,0,0.5); margin: 0 auto; display: block; background: #ffffff; padding: 15px;">
                <p style="text-align: center; color: #8E8E93; margin-top: 20px; font-style: italic; font-size: 0.95rem; max-width: 900px;">
                    <strong>Figure 1:</strong> Evolution of MoE architectures and their communication patterns. 
                    (a) Basic MoE with local gating and weighted expert outputs. 
                    (b) Standard Transformer block with single FFN for reference. 
                    (c) MoE Transformer block replacing FFN with multiple experts (FFN_1 to FFN_E). 
                    (d) Advanced MoE with distributed experts requiring All-to-all communication between layers, showing increased complexity for multi-GPU scaling with experts FFN_1 to FFN_K and FFN_(K+1) to FFN_2K.
                </p>
            </div>
        </div>

        <!-- Dataset Tabs -->
        <div class="dataset-tabs">
            <button class="tab-button active" onclick="switchDataset('random')">
                Random Dataset
            </button>
            <button class="tab-button" onclick="switchDataset('gsm8k')">
                GSM8K Dataset
            </button>
        </div>

        <!-- GSM8K Dataset Content -->
    <!-- GSM8K Dataset Content -->
    <div id="gsm8k-content" class="dataset-content">
            <!-- Hero Results for GSM8K -->
            <div class="hero-results">
                <div class="result-card winner">
                    <h3>
                        📊 GSM8K Dataset
                        <span class="winner-badge">Variable Output</span>
                    </h3>
                    <div class="result-metric">
                        <span class="metric-label">Dataset Type</span>
                        <span class="metric-value">Math Reasoning (openai/gsm8k)</span>
                    </div>
                    <div class="result-metric">
                        <span class="metric-label">Output Variance</span>
                        <span class="metric-value highlight">High (Variable Sequence Length)</span>
                    </div>
                    <div class="result-metric">
                        <span class="metric-label">Number of Requests</span>
                        <span class="metric-value">From NVIDIA Benchmark</span>
                    </div>
                    <div class="result-metric">
                        <span class="metric-label">Tokenizer</span>
                        <span class="metric-value">openai/gpt-oss-120b</span>
                    </div>
                    <div class="result-metric">
                        <span class="metric-label">Best Config (4 GPU)</span>
                        <span class="metric-value">15,622 tok/s/gpu (CUTLASS)</span>
                    </div>
                </div>

                <div class="result-card">
                    <h3>
                        ⚡ Scaling Efficiency
                        <span class="winner-badge">Throughput Performance</span>
                    </h3>
                    <div class="result-metric">
                        <span class="metric-label">Ideal</span>
                        <span class="metric-value">No experts load imbalance</span>
                    </div>
                    <div class="result-metric">
                        <span class="metric-label">EP=4 (CUTLASS)</span>
                        <span class="metric-value">-2.17% from Ideal</span>
                    </div>
                    <div class="result-metric">
                        <span class="metric-label">EP=4 (TRTLLM)</span>
                        <span class="metric-value">-3.08% from Ideal</span>
                    </div>
                    <div class="result-metric">
                        <span class="metric-label">EP=8 (CUTLASS)</span>
                        <span class="metric-value">-7.92% from Ideal</span>
                    </div>
                    <div class="result-metric">
                        <span class="metric-label">EP=8 (TRTLLM)</span>
                        <span class="metric-value">-10.86% from Ideal</span>
                    </div>
                </div>
            </div>

            <!-- GSM8K Charts -->
            <div class="section">
                <h2>GSM8K: MOE Load Balance Impact Analysis</h2>
                
                <div class="chart-container">
                    <h3>Throughput/GPU Scaling with GPU Count</h3>
                    <div class="chart-wrapper">
                        <canvas id="gsm8k-throughput-chart"></canvas>
                    </div>
                </div>

                <div class="chart-container">
                    <h3>Latency Scaling with GPU Count</h3>
                    <div class="chart-wrapper">
                        <canvas id="gsm8k-latency-chart"></canvas>
                    </div>
                </div>
                
                <!-- Performance Gap Analysis -->
                <div style="overflow-x: auto; margin-top: 30px;">
                    <h3>Throughput Performance (GSM8K Dataset)</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>GPUs</th>
                                <th>EP Size</th>
                                <th>MoE Backend</th>
                                <th>Ideal Throughput(tokens/s/gpu)</th>
                                <th>Actual Throughput(tokens/s/gpu)</th>
                                <th>Throughput Gap</th>

                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>2</td>
                                <td>2</td>
                                <td>CUTLASS</td>
                                <td>14,437.10</td>
                                <td>14,216.19</td>
                                <td class="perf-neutral">-1.53%</td>
                            </tr>
                            <tr>
                                <td>2</td>
                                <td>2</td>
                                <td>TRTLLM</td>
                                <td>14,377.10</td>
                                <td>14,098.34</td>
                                <td class="perf-neutral">-1.94%</td>
                            </tr>
                            <tr class="highlight">
                                <td><strong>4</strong></td>
                                <td><strong>4</strong></td>
                                <td><strong>CUTLASS</strong></td>
                                <td><strong>15,968.47</strong></td>
                                <td><strong>15,622.13</strong></td>
                                <td class="perf-neutral"><strong>-2.17%</strong></td>
                            </tr>
                            <tr>
                                <td>4</td>
                                <td>4</td>
                                <td>TRTLLM</td>
                                <td>15,886.68</td>
                                <td>15,397.04</td>
                                <td class="perf-neutral">-3.08%</td>
                            </tr>
                            <tr>
                                <td>8</td>
                                <td>8</td>
                                <td>CUTLASS</td>
                                <td>11,553.53</td>
                                <td>10,699.03</td>
                                <td class="perf-bad">-7.92%</td>
                            </tr>
                            <tr>
                                <td>8</td>
                                <td>8</td>
                                <td>TRTLLM</td>
                                <td>9,666.57</td>
                                <td>8,616.56</td>
                                <td class="perf-bad">-10.86%</td>
                            </tr>
                        </tbody>
                    </table>
                    <h3>Total Latency Performance (GSM8K Dataset)</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>GPUs</th>   
                                <th>EP Size</th>
                                <th>MoE Backend</th>
                                <th>Ideal Total Latency(s)</th>
                                <th>Actual Total Latency(s)</th>
                                <th>Latency Gap</th>
                                
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>2</td>
                                <td>2</td>
                                <td>CUTLASS</td>
                                <td>8.65</td>
                                <td>8.78</td>
                                <td class="perf-neutral">+1.55%</td>
                            </tr>
                            <tr>
                                <td>2</td>
                                <td>2</td>
                                <td>TRTLLM</td>
                                <td>8.69</td>
                                <td>8.86</td>
                                <td class="perf-neutral">+1.98%</td>
                            </tr>
                            <tr class="highlight">
                                <td><strong>4</strong></td>
                                <td><strong>4</strong></td>
                                <td><strong>CUTLASS</strong></td>
                                <td><strong>14.68</strong></td>
                                <td><strong>15.00</strong></td>
                                <td class="perf-neutral"><strong>+2.22%</strong></td>
                            </tr>
                            <tr>
                                <td>4</td>
                                <td>4</td>
                                <td>TRTLLM</td>
                                <td>14.75</td>
                                <td>15.22</td>
                                <td class="perf-neutral">+3.18%</td>
                            </tr>
                            <tr>
                                <td>8</td>
                                <td>8</td>
                                <td>CUTLASS</td>
                                <td>7.90</td>
                                <td>8.53</td>
                                <td class="perf-bad">+7.99%</td>
                            </tr>
                            <tr>
                                <td>8</td>
                                <td>8</td>
                                <td>TRTLLM</td>
                                <td>9.44</td>
                                <td>10.59</td>
                                <td class="perf-bad">+12.19%</td>
                            </tr>
                        </tbody>
                    </table>

                </div>
            </div>
        </div>

        <!-- Random Dataset Content -->
    <div id="random-content" class="dataset-content active">
            <!-- Hero Results for Random Dataset -->
            <div class="hero-results">
                <div class="result-card winner">
                    <h3>
                        📊 Random Dataset
                        <span class="winner-badge">1k Input / 2k Output</span>
                    </h3>
                    <div class="result-metric">
                        <span class="metric-label">Dataset Type</span>
                        <span class="metric-value">Fixed Sequence Length</span>
                    </div>
                    <div class="result-metric">
                        <span class="metric-label">Input Tokens</span>
                        <span class="metric-value highlight">1024 (fixed)</span>
                    </div>
                    <div class="result-metric">
                        <span class="metric-label">Output Tokens</span>
                        <span class="metric-value highlight">2048 (fixed)</span>
                    </div>
                    <div class="result-metric">
                        <span class="metric-label">Number of Requests</span>
                        <span class="metric-value">20,000</span>
                    </div>
                    <div class="result-metric">
                        <span class="metric-label">Tokenizer</span>
                        <span class="metric-value">openai/gpt-oss-120b</span>
                    </div>
                    <div class="result-metric">
                        <span class="metric-label">Best Config (4 GPU)</span>
                        <span class="metric-value">20,859 tok/s/gpu</span>
                    </div>
                    <div class="result-metric">
                        <span class="metric-label">vs NVIDIA Reference</span>
                        <span class="metric-value highlight">1.07x</span>
                    </div>
                </div>

                <div class="result-card">
                    <h3>
                        ⚡ Scaling Efficiency
                        <span class="winner-badge">Throughput Performance</span>
                    </h3>
                    <div class="result-metric">
                        <span class="metric-label">Ideal</span>
                        <span class="metric-value">No experts load imbalance</span>
                    </div>
                    <div class="result-metric">
                        <span class="metric-label">EP=4 (CUTLASS)</span>
                        <span class="metric-value">-10.4% from Ideal</span>
                    </div>
                    <div class="result-metric">
                        <span class="metric-label">EP=4 (TRTLLM)</span>
                        <span class="metric-value">-8.1% from Ideal</span>
                    </div>
                    <div class="result-metric">
                        <span class="metric-label">EP=8 (CUTLASS)</span>
                        <span class="metric-value">-18.3% from Ideal</span>
                    </div>
                    <div class="result-metric">
                        <span class="metric-label">EP=8 (TRTLLM)</span>
                        <span class="metric-value">-16.9% from Ideal</span>
                    </div>
                </div>
            </div>

            <!-- Random Dataset Charts -->
            <div class="section">
                <h2>Random Dataset: Scaling & Load Balance Analysis</h2>
                
                <div class="chart-container">
                    <h3>Throughput/GPU Scaling with GPU Count</h3>
                    <div class="chart-wrapper">
                        <canvas id="random-scaling-chart"></canvas>
                    </div>
                </div>
                
                <!-- <div class="chart-container">
                    <h3>Load Balance Impact by EP Size</h3>
                    <div class="chart-wrapper">
                        <canvas id="random-impact-chart"></canvas>
                    </div>
                </div> -->

                <div class="chart-container">
                    <h3>Latency Scaling with GPU Count</h3>
                    <div class="chart-wrapper">
                        <canvas id="random-latency-scaling-chart"></canvas>
                    </div>
                </div>
                
                <!-- Detailed Performance Table -->
                <div style="overflow-x: auto; margin-top: 30px;">
                    <h3>Throughput Performance (Random Dataset)</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>GPUs</th>
                                <th>EP Size</th>
                                <th>MoE Backend</th>
                                <th>Ideal Throughput(tokens/s/gpu)</th>
                                <th>Actual Throughput(tokens/s/gpu)</th>
                                <th>Throughput Gap</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1</td>
                                <td>1</td>
                                <td>CUTLASS</td>
                                <td>15,795</td>
                                <td>15,795</td>
                                <td class="perf-good">0%</td>
                            </tr>
                            <tr>
                                <td>1</td>
                                <td>1</td>
                                <td>TRTLLM</td>
                                <td>14,256</td>
                                <td>14,256</td>
                                <td class="perf-good">0%</td>
                            </tr>
                            <tr>
                                <td>2</td>
                                <td>2</td>
                                <td>CUTLASS</td>
                                <td>19,702</td>
                                <td>18,550</td>
                                <td class="perf-neutral">-5.8%</td>
                            </tr>
                            <tr>
                                <td>2</td>
                                <td>2</td>
                                <td>TRTLLM</td>
                                <td>18,582</td>
                                <td>17,161</td>
                                <td class="perf-neutral">-7.6%</td>
                            </tr>
                            <tr class="highlight">
                                <td><strong>4</strong></td>
                                <td><strong>4</strong></td>
                                <td><strong>CUTLASS</strong></td>
                                <td><strong>23,277</strong></td>
                                <td><strong>20,859</strong></td>
                                <td class="perf-bad"><strong>-10.4%</strong></td>
                            </tr>
                            <tr>
                                <td>4</td>
                                <td>4</td>
                                <td>TRTLLM</td>
                                <td>19,639</td>
                                <td>18,051</td>
                                <td class="perf-bad">-8.1%</td>
                            </tr>
                            <tr>
                                <td>8</td>
                                <td>8</td>
                                <td>CUTLASS</td>
                                <td>23,696</td>
                                <td>19,355</td>
                                <td class="perf-bad">-18.3%</td>
                            </tr>
                            <tr>
                                <td>8</td>
                                <td>8</td>
                                <td>TRTLLM</td>
                                <td>17,665</td>
                                <td>14,678</td>
                                <td class="perf-bad">-16.9%</td>
                            </tr>
                        </tbody>
                    </table>
                    <h3>Total Latency Performance (Random Dataset)</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>GPUs</th>   
                                <th>EP Size</th>
                                <th>MoE Backend</th>
                                <th>Ideal Total Latency(s)</th>
                                <th>Actual Total Latency(s)</th>
                                <th>Latency Gap</th>
                                
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1</td>
                                <td>1</td>
                                <td>CUTLASS</td>
                                <td>248.956</td>
                                <td>248.956</td>
                                <td class="perf-good">0%</td>
                            </tr>
                            <tr>
                                <td>1</td>
                                <td>1</td>
                                <td>TRTLLM</td>
                                <td>275.824</td>
                                <td>275.824</td>
                                <td class="perf-good">0%</td>
                            </tr>
                            <tr>
                                <td>2</td>
                                <td>2</td>
                                <td>CUTLASS</td>
                                <td>199.580</td>
                                <td>211.977</td>
                                <td class="perf-neutral">+6.2%</td>
                            </tr>
                            <tr>
                                <td>2</td>
                                <td>2</td>
                                <td>TRTLLM</td>
                                <td>211.616</td>
                                <td>229.135</td>
                                <td class="perf-neutral">+8.3%</td>
                            </tr>
                            <tr class="highlight">
                                <td><strong>4</strong></td>
                                <td><strong>4</strong></td>
                                <td><strong>CUTLASS</strong></td>
                                <td><strong>168.929</strong></td>
                                <td><strong>188.509</strong></td>
                                <td class="perf-bad"><strong>+11.6%</strong></td>
                            </tr>
                            <tr>
                                <td>4</td>
                                <td>4</td>
                                <td>TRTLLM</td>
                                <td>200.225</td>
                                <td>217.835</td>
                                <td class="perf-bad">+8.8%</td>
                            </tr>
                            <tr>
                                <td>8</td>
                                <td>8</td>
                                <td>CUTLASS</td>
                                <td>168.929</td>
                                <td>188.509</td>
                                <td class="perf-bad">+11.6%</td>
                            </tr>
                            <tr>
                                <td>8</td>
                                <td>8</td>
                                <td>TRTLLM</td>
                                <td>200.225</td>
                                <td>217.835</td>
                                <td class="perf-bad">+8.8%</td>
                            </tr>
                        </tbody>
                    </table>
                    <!-- Expert Parallelism Charts -->
                    <div style="margin-top: 60px; margin-bottom: 60px;">
                        <h2 style="text-align: center; font-size: 2rem; margin-bottom: 40px; background: linear-gradient(135deg, #5E5CE6 0%, #60a5fa 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">Expert Parallelism Analysis</h2>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 40px;">
                            <!-- Throughput Chart -->
                            <div style="background: rgba(28, 28, 30, 0.8); border: 1px solid #2C2C2E; border-radius: 16px; padding: 30px; backdrop-filter: blur(10px);">
                                <h3 style="font-size: 1.3rem; margin-bottom: 20px; color: #60a5fa;">Throughput Impact (tok/s)</h3>
                                <div style="position: relative; height: 350px;">
                                    <canvas id="ep-throughput-chart"></canvas>
                                </div>
                                <p style="font-size: 0.9rem; color: #8E8E93; margin-top: 15px; padding-top: 15px; border-top: 1px solid #2C2C2E;">
                                    Comparison of output throughput per GPU across CUTLASS and TRT-LLM backends with Open and Closed Expert Parallelism configurations.
                                </p>
                            </div>
                            
                            <!-- Latency Chart -->
                            <div style="background: rgba(28, 28, 30, 0.8); border: 1px solid #2C2C2E; border-radius: 16px; padding: 30px; backdrop-filter: blur(10px);">
                                <h3 style="font-size: 1.3rem; margin-bottom: 20px; color: #60a5fa;">Latency Impact (ms)</h3>
                                <div style="position: relative; height: 350px;">
                                    <canvas id="ep-latency-chart"></canvas>
                                </div>
                                <p style="font-size: 0.9rem; color: #8E8E93; margin-top: 15px; padding-top: 15px; border-top: 1px solid #2C2C2E;">
                                    Total latency comparison across different GPU configurations and Expert Parallelism sizes. Lower values indicate better performance.
                                </p>
                            </div>
                        </div>
                    </div>
                    <!-- Benchmark Results Table -->
                     <div style="margin-top: 40px;">
                        <h3>Expert Parallelism: Throughput Impact Across MoE Backends</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>MoE Backend</th>
                                    <th>GPUs</th>
                                    <th>EP Size</th>
                                    <th>Output Throughput/GPU (tok/s)</th>
                                    <th>Throughput Gap (%)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td><strong>CUTLASS (Open EP)</strong></td><td><strong>8</strong></td><td><strong>8</strong></td><td><strong>19355.29</strong></td><td class="perf-good"><strong>+30.5%</strong></td></tr>
                                <tr><td>CUTLASS (Closed EP)</td><td>8</td><td>1</td><td>14834.88</td><td class="perf-good">0%</td></tr>
                                <tr><td><strong>CUTLASS (Open EP)</strong></td><td><strong>4</strong></td><td><strong>4</strong></td><td><strong>20859.29</strong></td><td class="perf-neutral"><strong>+11.1%</strong></td></tr>
                                <tr><td>CUTLASS (Closed EP)</td><td>4</td><td>1</td><td>18785.89</td><td class="perf-neutral">0%</td></tr>
                                <tr><td><strong>CUTLASS (Open EP)</strong></td><td><strong>2</strong></td><td><strong>2</strong></td><td><strong>18549.97</strong></td><td class="perf-neutral"><strong>+7.5%</strong></td></tr>
                                <tr><td>CUTLASS (Closed EP)</td><td>2</td><td>1</td><td>17249.07</td><td class="perf-neutral">0%</td></tr>
                                <tr><td><strong>TRTLLM (Open EP)</strong></td><td><strong>8</strong></td><td><strong>8</strong></td><td><strong>14677.82</strong></td><td class="perf-bad"><strong>-13.4%</strong></td></tr>
                                <tr><td>TRTLLM (Closed EP)</td><td>8</td><td>1</td><td>16954.52</td><td class="perf-bad">0%</td></tr>
                                <tr><td><strong>TRTLLM (Open EP)</strong></td><td><strong>4</strong></td><td><strong>4</strong></td><td><strong>18051.06</strong></td><td class="perf-bad"><strong>-12.3%</strong></td></tr>
                                <tr><td>TRTLLM (Closed EP)</td><td>4</td><td>1</td><td>20584.83</td><td class="perf-bad">0%</td></tr>
                                <tr><td><strong>TRTLLM (Open EP)</strong></td><td><strong>2</strong></td><td><strong>2</strong></td><td><strong>17160.87</strong></td><td class="perf-bad"><strong>-4.5%</strong></td></tr>
                                <tr><td>TRTLLM (Closed EP)</td><td>2</td><td>1</td><td>17969.66</td><td class="perf-bad">0%</td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div style="margin-top: 40px;">
                        <h3>Expert Parallelism: Latency Impact Across MoE Backends</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>MoE Backend</th>
                                    <th>GPUs</th>
                                    <th>EP Size</th>
                                    <th>Total Latency (ms)</th>
                                    <th>Latency Gap (%)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td><strong>CUTLASS (Open EP)</strong></td><td><strong>8</strong></td><td><strong>8</strong></td><td><strong>203156.85</strong></td><td class="perf-good"><strong>-23.3%</strong></td></tr>
                                <tr><td>CUTLASS (Closed EP)</td><td>8</td><td>1</td><td>265061.79</td><td class="perf-good">0%</td></tr>
                                <tr><td><strong>CUTLASS (Open EP)</strong></td><td><strong>4</strong></td><td><strong>4</strong></td><td><strong>188508.83</strong></td><td class="perf-neutral"><strong>-9.9%</strong></td></tr>
                                <tr><td>CUTLASS (Closed EP)</td><td>4</td><td>1</td><td>209314.52</td><td class="perf-neutral">0%</td></tr>
                                <tr><td><strong>CUTLASS (Open EP)</strong></td><td><strong>2</strong></td><td><strong>2</strong></td><td><strong>211976.65</strong></td><td class="perf-neutral"><strong>-7.0%</strong></td></tr>
                                <tr><td>CUTLASS (Closed EP)</td><td>2</td><td>1</td><td>227963.58</td><td class="perf-neutral">0%</td></tr>
                                <tr><td><strong>TRTLLM (Open EP)</strong></td><td><strong>8</strong></td><td><strong>8</strong></td><td><strong>267898.03</strong></td><td class="perf-bad"><strong>+15.5%</strong></td></tr>
                                <tr><td>TRTLLM (Closed EP)</td><td>8</td><td>1</td><td>231924.01</td><td class="perf-bad">0%</td></tr>
                                <tr><td><strong>TRTLLM (Open EP)</strong></td><td><strong>4</strong></td><td><strong>4</strong></td><td><strong>217835.41</strong></td><td class="perf-bad"><strong>+14.0%</strong></td></tr>
                                <tr><td>TRTLLM (Closed EP)</td><td>4</td><td>1</td><td>191022.23</td><td class="perf-bad">0%</td></tr>
                                <tr><td><strong>TRTLLM (Open EP)</strong></td><td><strong>2</strong></td><td><strong>2</strong></td><td><strong>229135.21</strong></td><td class="perf-bad"><strong>+4.7%</strong></td></tr>
                                <tr><td>TRTLLM (Closed EP)</td><td>2</td><td>1</td><td>218822.20</td><td class="perf-bad">0%</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Key Insights Section -->
        <div class="insights-section">
            <h2>Insights</h2>
            <div class="insights-grid">
                <div class="insight-card">
                    <h3>📊 Conclusion</h3>
                    
                    <div class="conclusion-intro">
                        <p>As the <strong>number of GPUs</strong> and <strong>EP size</strong> increase, the <strong>MoE load‑balancing problem becomes more severe</strong>.</p>
                    </div>
                    
                    <div class="insight-section-group">
                        <h4 class="insight-subsection-title">📈 Performance Degradation</h4>
                        <ul class="insight-list">
                            <li><strong>Throughput gap grows</strong> with scale — on GSM8K the gap widens from ~2–3% at EP=4 to ~8–11% at EP=8</li>
                            <li><strong>Latency gap also increases</strong> — from ~1.5–3.2% at EP=2–4 to ~8–12% at EP=8</li>
                            <li>Primary contributors: heavier all‑to‑all traffic, router skew, and per‑expert queuing/overflow</li>
                        </ul>
                    </div>
                    
                    <div class="insight-section-group">
                        <h4 class="insight-subsection-title">💡 Practical Mitigations</h4>
                        <ul class="insight-list">
                            <li>Tune auxiliary load‑balancing loss and capacity factor; consider dropless routing when feasible</li>
                            <li><strong>Speculative decoding–based expert prefetch</strong>: use a lightweight drafter to predict token‑to‑expert routes, prefetch the top‑k “hot” experts ahead of verification, and cap overfetch with a cutoff policy.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="customTooltip" class="custom-tooltip">
        <div class="tooltip-title"></div>
        <div class="tooltip-content"></div>
        <div class="tooltip-gap"></div>
    </div>

    <script>
        // Dataset switching function
        function switchDataset(dataset) {
            // Update tab buttons
            const tabs = document.querySelectorAll('.tab-button');
            tabs.forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // Update content
            const contents = document.querySelectorAll('.dataset-content');
            contents.forEach(content => content.classList.remove('active'));
            document.getElementById(`${dataset}-content`).classList.add('active');
        }

        // Copy to Clipboard
        function copyToClipboard(event) {
            event.preventDefault();
            const button = event.target;
            const codeBlock = button.closest('.code-block');
            const code = codeBlock.querySelector('code').textContent;
            
            navigator.clipboard.writeText(code).then(() => {
                const originalText = button.textContent;
                button.textContent = '✅ Copied!';
                button.classList.add('copied');
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                console.error('Copy failed:', err);
                button.textContent = '❌ Failed';
            });
        }
        
        // Toggle Section Expand/Collapse
        function toggleSection(header) {
            // Find the closest .command-section parent
            const section = header.closest('.command-section');
            // Find the first .section-content inside this section
            const content = section.querySelector('.section-content');
            const toggleIcon = header.querySelector('.toggle-icon');
            if (content) {
                content.classList.toggle('collapsed');
            }
            if (toggleIcon) {
                toggleIcon.classList.toggle('collapsed');
            }
        }

        // Chart configuration with custom tooltips
        document.addEventListener('DOMContentLoaded', function() {
            // Common chart options
            const commonOptions = {
                responsive: true,
                maintainAspectRatio: false,
                interaction: {
                    mode: 'point',
                    intersect: false
                },
                plugins: {
                    legend: {
                        labels: {
                            color: '#e2e8f0',
                            font: {
                                size: 14,
                                weight: '600'
                            }
                        }
                    },
                    tooltip: {
                        enabled: true
                    }
                },
                scales: {
                    x: {
                        grid: {
                            color: 'rgba(71, 85, 105, 0.2)',
                            borderDash: [3, 3]
                        },
                        ticks: {
                            color: '#e2e8f0',
                            font: {
                                size: 18
                            }
                        },
                        title: {
                            display: true,
                            text: 'EP Size',
                            color: '#e2e8f0',
                            font: {
                                size: 12,
                                weight: '600'
                            }
                        }
                    },
                    y: {
                        grid: {
                            color: 'rgba(71, 85, 105, 0.2)',
                            borderDash: [3, 3]
                        },
                        ticks: {
                            color: '#e2e8f0',
                            font: {
                                size: 16
                            }
                        },
                        title: {
                            display: true,
                            color: '#e2e8f0',
                            font: {
                                size: 12,
                                weight: '600'
                            }
                        }
                    }
                }
            };

            // GSM8K Latency Chart
            const gsm8kLatencyCtx = document.getElementById('gsm8k-latency-chart');
            if (gsm8kLatencyCtx) {
                const gsm8kLatencyOptions = JSON.parse(JSON.stringify(commonOptions));
                gsm8kLatencyOptions.scales.y.title.text = 'Total Latency (s) - Lower is Better';
                
                new Chart(gsm8kLatencyCtx, {
                    type: 'line',
                    data: {
                        labels: ['2', '4', '8'],
                        datasets: [
                            {
                                label: 'CUTLASS Ideal',
                                data: [8.65, 14.68, 7.90],
                                borderColor: '#10b981',
                                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                borderWidth: 3,
                                borderDash: [8, 4],
                                tension: 0.2,
                                pointRadius: 5,
                                pointHoverRadius: 8,
                                pointBackgroundColor: '#10b981',
                                pointBorderColor: '#fff',
                                pointBorderWidth: 2
                            },
                            {
                                label: 'CUTLASS Actual',
                                data: [8.78, 15.00, 8.53],
                                borderColor: '#f59e0b',
                                backgroundColor: 'rgba(245, 158, 11, 0.1)',
                                borderWidth: 3,
                                tension: 0.2,
                                pointRadius: 5,
                                pointHoverRadius: 8,
                                pointBackgroundColor: '#f59e0b',
                                pointBorderColor: '#fff',
                                pointBorderWidth: 2
                            },
                            {
                                label: 'TRTLLM Ideal',
                                data: [8.69, 14.75, 9.44],
                                borderColor: '#60a5fa',
                                backgroundColor: 'rgba(96, 165, 250, 0.1)',
                                borderWidth: 3,
                                borderDash: [8, 4],
                                tension: 0.2,
                                pointRadius: 5,
                                pointHoverRadius: 8,
                                pointBackgroundColor: '#60a5fa',
                                pointBorderColor: '#fff',
                                pointBorderWidth: 2
                            },
                            {
                                label: 'TRTLLM Actual',
                                data: [8.86, 15.22, 10.59],
                                borderColor: '#ef4444',
                                backgroundColor: 'rgba(239, 68, 68, 0.1)',
                                borderWidth: 3,
                                tension: 0.2,
                                pointRadius: 5,
                                pointHoverRadius: 8,
                                pointBackgroundColor: '#ef4444',
                                pointBorderColor: '#fff',
                                pointBorderWidth: 2
                            }
                        ]
                    },
                    options: gsm8kLatencyOptions
                });
            }

            // GSM8K Throughput Chart
            const gsm8kThroughputCtx = document.getElementById('gsm8k-throughput-chart');
            if (gsm8kThroughputCtx) {
                const gsm8kThroughputOptions = JSON.parse(JSON.stringify(commonOptions));
                gsm8kThroughputOptions.scales.y.title.text = 'Throughput (tokens/s/GPU) - Higher is Better';
                
                new Chart(gsm8kThroughputCtx, {
                    type: 'line',
                    data: {
                        labels: ['2', '4', '8'],
                        datasets: [
                            {
                                label: 'CUTLASS Ideal',
                                data: [14437.10, 15968.47, 11553.53],
                                borderColor: '#10b981',
                                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                borderWidth: 3,
                                borderDash: [8, 4],
                                tension: 0.2,
                                pointRadius: 5,
                                pointHoverRadius: 8,
                                pointBackgroundColor: '#10b981',
                                pointBorderColor: '#fff',
                                pointBorderWidth: 2
                            },
                            {
                                label: 'CUTLASS Actual',
                                data: [14216.19, 15622.13, 10699.03],
                                borderColor: '#f59e0b',
                                backgroundColor: 'rgba(245, 158, 11, 0.1)',
                                borderWidth: 3,
                                tension: 0.2,
                                pointRadius: 5,
                                pointHoverRadius: 8,
                                pointBackgroundColor: '#f59e0b',
                                pointBorderColor: '#fff',
                                pointBorderWidth: 2
                            },
                            {
                                label: 'TRTLLM Ideal',
                                data: [14377.10, 15886.68, 9666.57],
                                borderColor: '#60a5fa',
                                backgroundColor: 'rgba(96, 165, 250, 0.1)',
                                borderWidth: 3,
                                borderDash: [8, 4],
                                tension: 0.2,
                                pointRadius: 5,
                                pointHoverRadius: 8,
                                pointBackgroundColor: '#60a5fa',
                                pointBorderColor: '#fff',
                                pointBorderWidth: 2
                            },
                            {
                                label: 'TRTLLM Actual',
                                data: [14098.34, 15397.04, 8616.56],
                                borderColor: '#ef4444',
                                backgroundColor: 'rgba(239, 68, 68, 0.1)',
                                borderWidth: 3,
                                tension: 0.2,
                                pointRadius: 5,
                                pointHoverRadius: 8,
                                pointBackgroundColor: '#ef4444',
                                pointBorderColor: '#fff',
                                pointBorderWidth: 2
                            }
                        ]
                    },
                    options: gsm8kThroughputOptions
                });
            }

            // Random Dataset Scaling Chart
            const randomScalingCtx = document.getElementById('random-scaling-chart');
            if (randomScalingCtx) {
                const randomScalingOptions = JSON.parse(JSON.stringify(commonOptions));
                randomScalingOptions.scales.x.title.text = 'Number of GPUs';
                randomScalingOptions.scales.y.title.text = 'Throughput per GPU (tokens/s)';
                
                new Chart(randomScalingCtx, {
                    type: 'line',
                    data: {
                        labels: ['1', '2', '4', '8'],
                        datasets: [
                            {
                                label: 'CUTLASS Ideal',
                                data: [15795, 19702, 23277, 23696],
                                borderColor: '#10b981',
                                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                borderWidth: 3,
                                borderDash: [8, 4],
                                tension: 0.2,
                                pointRadius: 6,
                                pointHoverRadius: 9,
                                pointBackgroundColor: '#10b981',
                                pointBorderColor: '#fff',
                                pointBorderWidth: 2
                            },
                            {
                                label: 'CUTLASS Actual',
                                data: [15795, 18550, 20859, 19355],
                                borderColor: '#f59e0b',
                                backgroundColor: 'rgba(245, 158, 11, 0.1)',
                                borderWidth: 3,
                                tension: 0.2,
                                pointRadius: 6,
                                pointHoverRadius: 9,
                                pointBackgroundColor: '#f59e0b',
                                pointBorderColor: '#fff',
                                pointBorderWidth: 2
                            },
                            {
                                label: 'TRTLLM Ideal',
                                data: [14256, 18582, 19639, 17665],
                                borderColor: '#60a5fa',
                                backgroundColor: 'rgba(96, 165, 250, 0.1)',
                                borderWidth: 3,
                                borderDash: [8, 4],
                                tension: 0.2,
                                pointRadius: 6,
                                pointHoverRadius: 9,
                                pointBackgroundColor: '#60a5fa',
                                pointBorderColor: '#fff',
                                pointBorderWidth: 2
                            },
                            {
                                label: 'TRTLLM Actual',
                                data: [14256, 17161, 18051, 14678],
                                borderColor: '#ef4444',
                                backgroundColor: 'rgba(239, 68, 68, 0.1)',
                                borderWidth: 3,
                                tension: 0.2,
                                pointRadius: 6,
                                pointHoverRadius: 9,
                                pointBackgroundColor: '#ef4444',
                                pointBorderColor: '#fff',
                                pointBorderWidth: 2
                            }
                        ]
                    },
                    options: randomScalingOptions
                });
            }

            // Random Dataset Latency Scaling Chart
            const randomLatencyScalingCtx = document.getElementById('random-latency-scaling-chart');
            if (randomLatencyScalingCtx) {
                const randomScalingOptions = JSON.parse(JSON.stringify(commonOptions));
                randomScalingOptions.scales.x.title.text = 'Number of GPUs';
                randomScalingOptions.scales.y.title.text = 'Total Latency (ms)';
                
                new Chart(randomLatencyScalingCtx, {
                    type: 'line',
                    data: {
                        labels: ['1', '2', '4', '8'],
                        datasets: [
                            {
                                label: 'CUTLASS Ideal',
                                data: [248.956, 199.580, 168.929, 168.929],
                                borderColor: '#10b981',
                                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                borderWidth: 3,
                                borderDash: [8, 4],
                                tension: 0.2,
                                pointRadius: 6,
                                pointHoverRadius: 9,
                                pointBackgroundColor: '#10b981',
                                pointBorderColor: '#fff',
                                pointBorderWidth: 2
                            },
                            {
                                label: 'CUTLASS Actual',
                                data: [248.956, 211.977, 188.509, 188.509],
                                borderColor: '#f59e0b',
                                backgroundColor: 'rgba(245, 158, 11, 0.1)',
                                borderWidth: 3,
                                tension: 0.2,
                                pointRadius: 6,
                                pointHoverRadius: 9,
                                pointBackgroundColor: '#f59e0b',
                                pointBorderColor: '#fff',
                                pointBorderWidth: 2
                            },
                            {
                                label: 'TRTLLM Ideal',
                                data: [275.824, 211.616, 200.225, 200.225],
                                borderColor: '#60a5fa',
                                backgroundColor: 'rgba(96, 165, 250, 0.1)',
                                borderWidth: 3,
                                borderDash: [8, 4],
                                tension: 0.2,
                                pointRadius: 6,
                                pointHoverRadius: 9,
                                pointBackgroundColor: '#60a5fa',
                                pointBorderColor: '#fff',
                                pointBorderWidth: 2
                            },
                            {
                                label: 'TRTLLM Actual',
                                data: [275.824, 229.135, 217.835, 217.835],
                                borderColor: '#ef4444',
                                backgroundColor: 'rgba(239, 68, 68, 0.1)',
                                borderWidth: 3,
                                tension: 0.2,
                                pointRadius: 6,
                                pointHoverRadius: 9,
                                pointBackgroundColor: '#ef4444',
                                pointBorderColor: '#fff',
                                pointBorderWidth: 2
                            }
                        ]
                    },
                    options: randomScalingOptions
                });
            }

            // Expert Parallelism Latency Chart
            const epLatencyCtx = document.getElementById('ep-latency-chart');
            if (epLatencyCtx) {
                const epOptions = JSON.parse(JSON.stringify(commonOptions));
                epOptions.scales.y.title.text = 'Total Latency (ms)';
                
                new Chart(epLatencyCtx, {
                    type: 'bar',
                    data: {
                        labels: ['8 GPUs', '4 GPUs', '2 GPUs'],
                        datasets: [
                            {
                                label: 'CUTLASS Open EP',
                                data: [203156.85, 188508.83, 211976.65],
                                backgroundColor: 'rgba(16, 185, 129, 0.7)',
                                borderColor: '#10b981',
                                borderWidth: 2
                            },
                            {
                                label: 'CUTLASS Closed EP',
                                data: [265061.79, 209314.52, 227963.58],
                                backgroundColor: 'rgba(245, 158, 11, 0.7)',
                                borderColor: '#f59e0b',
                                borderWidth: 2
                            },
                            {
                                label: 'TRTLLM Open EP',
                                data: [267898.03, 217835.41, 229135.21],
                                backgroundColor: 'rgba(96, 165, 250, 0.7)',
                                borderColor: '#60a5fa',
                                borderWidth: 2
                            },
                            {
                                label: 'TRTLLM Closed EP',
                                data: [231924.01, 191022.23, 218822.20],
                                backgroundColor: 'rgba(239, 68, 68, 0.7)',
                                borderColor: '#ef4444',
                                borderWidth: 2
                            }
                        ]
                    },
                    options: epOptions
                });
            }

            // Expert Parallelism Throughput Chart
            const epThroughputCtx = document.getElementById('ep-throughput-chart');
            if (epThroughputCtx) {
                const epOptions = JSON.parse(JSON.stringify(commonOptions));
                epOptions.scales.y.title.text = 'Output Throughput/GPU (tok/s)';
                
                new Chart(epThroughputCtx, {
                    type: 'bar',
                    data: {
                        labels: ['8 GPUs', '4 GPUs', '2 GPUs'],
                        datasets: [
                            {
                                label: 'CUTLASS Open EP',
                                data: [19355.29, 20859.29, 18549.97],
                                backgroundColor: 'rgba(16, 185, 129, 0.7)',
                                borderColor: '#10b981',
                                borderWidth: 2
                            },
                            {
                                label: 'CUTLASS Closed EP',
                                data: [14834.88, 18785.89, 17249.07],
                                backgroundColor: 'rgba(245, 158, 11, 0.7)',
                                borderColor: '#f59e0b',
                                borderWidth: 2
                            },
                            {
                                label: 'TRTLLM Open EP',
                                data: [14677.82, 18051.06, 17160.87],
                                backgroundColor: 'rgba(96, 165, 250, 0.7)',
                                borderColor: '#60a5fa',
                                borderWidth: 2
                            },
                            {
                                label: 'TRTLLM Closed EP',
                                data: [16954.52, 20584.83, 17969.66],
                                backgroundColor: 'rgba(239, 68, 68, 0.7)',
                                borderColor: '#ef4444',
                                borderWidth: 2
                            }
                        ]
                    },
                    options: epOptions
                });
            }

            // Random Dataset Impact Chart (Bar chart showing performance gap)
            const randomImpactCtx = document.getElementById('random-impact-chart');
            if (randomImpactCtx) {
                const randomImpactOptions = JSON.parse(JSON.stringify(commonOptions));
                randomImpactOptions.scales.x.title.text = 'Configuration (GPUs / EP Size)';
                randomImpactOptions.scales.y.title.text = 'Performance Gap from Ideal (%)';
                randomImpactOptions.plugins.tooltip.enabled = true;
                randomImpactOptions.plugins.tooltip.external = null;
                
                new Chart(randomImpactCtx, {
                    type: 'bar',
                    data: {
                        labels: ['1 GPU/EP=1', '2 GPUs/EP=2', '4 GPUs/EP=4', '8 GPUs/EP=8'],
                        datasets: [
                            {
                                label: 'CUTLASS Gap',
                                data: [0, -5.8, -10.4, -18.3],
                                backgroundColor: 'rgba(245, 158, 11, 0.7)',
                                borderColor: '#f59e0b',
                                borderWidth: 2
                            },
                            {
                                label: 'TRTLLM Gap',
                                data: [0, -7.6, -8.1, -16.9],
                                backgroundColor: 'rgba(239, 68, 68, 0.7)',
                                borderColor: '#ef4444',
                                borderWidth: 2
                            }
                        ]
                    },
                    options: randomImpactOptions
                });
            }
        });
    </script>
</body>
</html>